name: Email Agent Cron Job

on:
  schedule:
    - cron: '0 14 * * *' # 5PM EAT is 14:00 UTC
  workflow_dispatch:     # Optional: to trigger manually

jobs:
  run-email-agent:
    runs-on: ubuntu-latest
    env:
      GMAIL_API_KEY: ${{ secrets.GMAIL_API_KEY }}
      GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
      CLIENT_ID: ${{ secrets.CLIENT_ID }}
      CLIENT_SECRET: ${{ secrets.CLIENT_SECRET }}
      REDIRECT_URI: ${{ secrets.REDIRECT_URI }}
      REFRESH_TOKEN: ${{ secrets.REFRESH_TOKEN }}
      SCOPE: ${{ secrets.SCOPE }}

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'

    - name: Install dependencies
      run: npm install -g pnpm

    - name: Install dependencies
      run: pnpm install

    - name: Run the agent
      run: pnpm start
